ä»Žæ‚¨çš„åŽ†å²è®°å½•æ¥çœ‹ï¼Œä»Šå¤©ä¸»è¦æ¶‰åŠ **crontab å®šæ—¶ä»»åŠ¡**ã€**ThinkPHP å‘½ä»¤è¡Œ** å’Œ **ç³»ç»Ÿæ—¥å¿—** ç›¸å…³çš„æ“ä½œã€‚ä»¥ä¸‹æ˜¯æˆ‘ä¸ºæ‚¨æ•´ç†çš„å¸¸ç”¨å‘½ä»¤åŠè¯´æ˜Žï¼š

## ðŸ“… **Crontab å®šæ—¶ä»»åŠ¡ç›¸å…³**

| å‘½ä»¤                                        | è¯´æ˜Ž                         |
| ------------------------------------------- | ---------------------------- |
| `crontab -l`                                | æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡åˆ—è¡¨   |
| `crontab -e`                                | ç¼–è¾‘å½“å‰ç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡       |
| `systemctl restart cron`                    | é‡å¯ cron æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ     |
| `sudo tail -f /var/log/syslog \| grep cron` | å®žæ—¶æŸ¥çœ‹ cron ç›¸å…³çš„ç³»ç»Ÿæ—¥å¿— |

## ðŸ“ **æ–‡ä»¶æ“ä½œç›¸å…³**

| å‘½ä»¤                                  | è¯´æ˜Ž                      |
| ------------------------------------- | ------------------------- |
| `vim tempmsg`                         | ç”¨ vim ç¼–è¾‘ tempmsg æ–‡ä»¶  |
| `cat tempmsg`                         | æŸ¥çœ‹ tempmsg æ–‡ä»¶å†…å®¹     |
| `chmod 644 tempmsg`                   | ä¿®æ”¹æ–‡ä»¶æƒé™ä¸º 644        |
| `chown root:root /etc/cron.d/tempmsg` | ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…å’Œç»„ä¸º root |
| `chmod 755 CronTemplateMsg.php`       | ä¿®æ”¹ PHP è„šæœ¬ä¸ºå¯æ‰§è¡Œæƒé™ |

## ðŸ˜ **ThinkPHP/é¡¹ç›®ç›¸å…³**

| å‘½ä»¤                                                                                                     | è¯´æ˜Ž                       |
| -------------------------------------------------------------------------------------------------------- | -------------------------- |
| `cd /www/wwwroot/app.tutlab.tech && /usr/bin/php think cron:templateMsg`                                 | æ‰§è¡Œ ThinkPHP çš„å‘½ä»¤è¡Œä»»åŠ¡ |
| `php think clear`                                                                                        | æ¸…é™¤ ThinkPHP è¿è¡Œæ—¶ç¼“å­˜   |
| `php think clear --runtime`                                                                              | æ¸…é™¤è¿è¡Œæ—¶ç›®å½•             |
| `/usr/bin/php think cron:templateMsg >> /www/wwwroot/app.tutlab.tech/runtime/log/cron_temp_msg.log 2>&1` | æ‰§è¡Œå‘½ä»¤å¹¶è¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶   |

## ðŸ› ï¸ **è„šæœ¬ç®¡ç†ç›¸å…³**

| å‘½ä»¤                                                      | è¯´æ˜Ž                      |
| --------------------------------------------------------- | ------------------------- |
| `sudo nano /usr/local/bin/countdowncron.sh`               | åˆ›å»º/ç¼–è¾‘ shell è„šæœ¬      |
| `sudo chmod +x /usr/local/bin/countdowncron.sh`           | ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™        |
| `chown www-data:www-data /usr/local/bin/countdowncron.sh` | ä¿®æ”¹è„šæœ¬æ‰€æœ‰è€…ä¸º www-data |

## ðŸ” **å…¶ä»–å®žç”¨å‘½ä»¤**

| å‘½ä»¤                              | è¯´æ˜Ž                         |
| --------------------------------- | ---------------------------- |
| `ls`                              | åˆ—å‡ºå½“å‰ç›®å½•å†…å®¹             |
| `ls -al`                          | åˆ—å‡ºè¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶ï¼‰ |
| `history`                         | æŸ¥çœ‹å‘½ä»¤åŽ†å²è®°å½•             |
| `/usr/local/bin/countdowncron.sh` | æ‰§è¡Œ shell è„šæœ¬              |
| `tail -f /var/log/syslog`         | å®žæ—¶æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—             |

## ðŸ’¡ **å…³é”®æ“ä½œæ€»ç»“**

1. **å®šæ—¶ä»»åŠ¡è°ƒè¯•æµç¨‹**ï¼š

   ```
   crontab -e â†’ ç¼–è¾‘ä»»åŠ¡ â†’ systemctl restart cron â†’ tail -f /var/log/syslog æŸ¥çœ‹æ—¥å¿—
   ```

2. **ThinkPHP å‘½ä»¤æ‰§è¡Œ**ï¼š

   ```
   cd /é¡¹ç›®ç›®å½• && /usr/bin/php think å‘½ä»¤å
   ```

3. **æ—¥å¿—è¾“å‡ºæŠ€å·§**ï¼š
   ```
   å‘½ä»¤ >> æ—¥å¿—æ–‡ä»¶.log 2>&1  # å°†æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯éƒ½é‡å®šå‘åˆ°æ–‡ä»¶
   ```

æ‚¨ä»Šå¤©ä¸»è¦åœ¨è¿›è¡Œå®šæ—¶ä»»åŠ¡çš„é…ç½®å’Œè°ƒè¯•ï¼Œç‰¹åˆ«æ˜¯ä¸º ThinkPHP é¡¹ç›®é…ç½®æ¨¡æ¿æ¶ˆæ¯çš„å®šæ—¶æŽ¨é€ä»»åŠ¡ã€‚

0 5 \* \* \* /bin/bash /usr/local/bin/countdowncron.sh

```bash

#!/bin/bash
cd /www/wwwroot/app.tutlab.tech && /usr/bin/php think cron:templateMsg >> /www/wwwroot/app.tutlab.tech/runtime/log/cron_temp_msg.log 2>&1
```
